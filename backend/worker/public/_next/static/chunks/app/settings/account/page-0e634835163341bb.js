(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[496],{3630:function(e,t,r){Promise.resolve().then(r.bind(r,5328))},5328:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return w}});var a=r(7437),s=r(9376),o=r(2265),n=r(9501),i=r(3590),l=r(7119),c=r(2869),d=r(5186),u=r(6815),h=r(4991),m=r(6818),f=r(5153),g=r(407),p=r(2369),x=r(3245),b=r(7648),y=r(7855);let v=e=>e?e.startsWith("http")?e:"".concat("https://pharmx-api.kasimhussain333.workers.dev").concat(e):"",N=l.Ry({name:l.Z_().min(2).max(40),gender:l.Km(["male","female"]),dobDay:l.Z_().regex(/^(0?[1-9]|[12][0-9]|3[01])$/,"Invalid day"),dobMonth:l.Z_().regex(/^(0?[1-9]|1[012])$/,"Invalid month"),dobYear:l.Z_().regex(/^(19|20)\d{2}$/,"Invalid year").refine(e=>new Date().getFullYear()-parseInt(e)>=18,"You must be at least 18 years old"),bio:l.Z_().max(160),avatarUrl:l.Z_().optional()});function w(){var e,t,r,l;let w=(0,s.useRouter)(),{toast:S}=(0,f.pm)(),[j,I]=(0,o.useState)(""),[k,_]=(0,o.useState)(!1),[A,T]=(0,o.useState)(""),[D,E]=(0,o.useState)(""),[P,M]=(0,o.useState)(""),{register:O,handleSubmit:U,formState:{errors:q,isSubmitting:F},setValue:R,watch:C}=(0,n.cI)({resolver:(0,i.F)(N)}),Y=C();(0,o.useEffect)(()=>{z()},[]);let z=async()=>{try{let e=await y.x.profile.get(),t={name:e.name||e.username||"",email:e.email||"",gender:e.gender||"male",dob:e.dob||"",bio:e.bio||"",avatarUrl:e.avatar_url||e.profile_picture_url||null};if(I(v(t.avatarUrl)),R("name",t.name),R("gender",t.gender),R("bio",t.bio),R("avatarUrl",t.avatarUrl||""),t.dob){let e=new Date(t.dob),r=e.getDate().toString().padStart(2,"0"),a=(e.getMonth()+1).toString().padStart(2,"0"),s=e.getFullYear().toString();T(r),E(a),M(s),R("dobDay",r),R("dobMonth",a),R("dobYear",s)}}catch(e){console.error("Error fetching profile:",e),S({title:"Error loading profile",description:"Failed to load your profile data",variant:"destructive"})}},L=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!r)return;if(r.size>10485760){S({title:"File too large",description:"Please select an image under 10MB",variant:"destructive"});return}let a=new FileReader;a.onloadend=()=>{I(a.result)},a.readAsDataURL(r),_(!0);try{let e=await y.x.profile.uploadAvatar(r);R("avatarUrl",e.url),I(v(e.url)),S({title:"Photo updated",description:"Your profile photo has been updated"})}catch(e){console.error("Upload error:",e),S({title:"Upload failed",description:e instanceof Error?e.message:"Failed to upload image",variant:"destructive"})}finally{_(!1)}},Z=async e=>{try{let t="".concat(e.dobYear,"-").concat(e.dobMonth.padStart(2,"0"),"-").concat(e.dobDay.padStart(2,"0")),r={name:e.name,gender:e.gender,dob:t,bio:e.bio,avatarUrl:e.avatarUrl};await y.x.profile.update(r),S({title:"Profile updated",description:"Your profile has been successfully updated"}),await z()}catch(e){console.error("Profile update error:",e),S({title:"Update failed",description:e instanceof Error?e.message:"Failed to update profile",variant:"destructive"})}},B=async()=>{if(window.confirm("Are you sure you want to delete your account? This action cannot be undone."))try{await y.x.profile.delete(),y.x.clearAuth(),S({title:"Account deleted",description:"Your account has been removed"}),w.push("/login")}catch(e){console.error("Delete account error:",e),S({title:"Deletion failed",description:e instanceof Error?e.message:"Failed to delete account",variant:"destructive"})}};return(0,a.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,a.jsx)("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm border-b z-10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,a.jsx)(b.default,{href:"/settings",className:"p-2 -ml-2",children:(0,a.jsx)(g.Z,{className:"h-5 w-5 rotate-180"})}),(0,a.jsx)("h1",{className:"text-lg font-semibold",children:"Account"}),(0,a.jsx)("div",{className:"w-9"})]})}),(0,a.jsx)("div",{className:"flex items-center justify-center p-4",children:(0,a.jsx)("div",{className:"w-full max-w-md",children:(0,a.jsx)("div",{className:"bg-white dark:bg-card rounded-2xl shadow-xl p-8",children:(0,a.jsxs)("form",{onSubmit:U(Z),className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-3",children:[(0,a.jsx)("div",{className:"relative w-48 h-48 rounded-lg overflow-hidden border-4 border-gray-200",children:j?(0,a.jsx)("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:"url(".concat(j,")")}}):(0,a.jsx)("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center",children:(0,a.jsx)(p.Z,{className:"w-16 h-16 text-gray-400"})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(d.I,{id:"avatar",type:"file",accept:"image/*",className:"hidden",onChange:L,disabled:k}),(0,a.jsx)(u._,{htmlFor:"avatar",className:"cursor-pointer inline-block",children:(0,a.jsx)("div",{className:"bg-white hover:bg-gray-100 text-black border border-gray-300 px-4 py-2 rounded-md text-sm font-medium transition-colors",children:k?"Uploading...":"Upload Photo"})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u._,{htmlFor:"name",className:"text-gray-700 font-medium",children:"Name"}),(0,a.jsx)(d.I,{id:"name",placeholder:"Your display name",className:"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500",...O("name")}),q.name&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:q.name.message})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u._,{className:"text-gray-700 font-medium",children:"Gender"}),(0,a.jsxs)(h.E,{value:C("gender"),className:"flex gap-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(h.m,{value:"male",id:"male",disabled:!0,className:"text-black border-gray-400"}),(0,a.jsx)(u._,{htmlFor:"male",className:"text-gray-700",children:"Male"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(h.m,{value:"female",id:"female",disabled:!0,className:"text-black border-gray-400"}),(0,a.jsx)(u._,{htmlFor:"female",className:"text-gray-700",children:"Female"})]})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[(0,a.jsx)(x.Z,{className:"w-3 h-3"})," Cannot be changed"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u._,{className:"text-gray-700 font-medium",children:"Date of Birth"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(d.I,{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"DD",maxLength:2,className:"w-full text-center border-gray-300 focus:border-blue-500 focus:ring-blue-500",...O("dobDay"),onChange:e=>{let t=e.target.value.replace(/\D/g,"");if(T(t),R("dobDay",t),2===t.length){let e=document.querySelector('input[name="dobMonth"]');null==e||e.focus()}},value:A})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(d.I,{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"MM",maxLength:2,className:"w-full text-center border-gray-300 focus:border-blue-500 focus:ring-blue-500",...O("dobMonth"),onChange:e=>{let t=e.target.value.replace(/\D/g,"");if(E(t),R("dobMonth",t),2===t.length){let e=document.querySelector('input[name="dobYear"]');null==e||e.focus()}},value:D})}),(0,a.jsx)("div",{className:"flex-[1.5]",children:(0,a.jsx)(d.I,{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"YYYY",maxLength:4,className:"w-full text-center border-gray-300 focus:border-blue-500 focus:ring-blue-500",...O("dobYear"),onChange:e=>{let t=e.target.value.replace(/\D/g,"");M(t),R("dobYear",t)},value:P})})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"You must be 18 or older"}),(q.dobDay||q.dobMonth||q.dobYear)&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:(null===(e=q.dobDay)||void 0===e?void 0:e.message)||(null===(t=q.dobMonth)||void 0===t?void 0:t.message)||(null===(r=q.dobYear)||void 0===r?void 0:r.message)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(u._,{htmlFor:"bio",className:"text-gray-700 font-medium",children:"Bio"}),(0,a.jsx)(m.g,{id:"bio",placeholder:"Tell us about yourself...",className:"resize-none h-24 w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500",maxLength:160,...O("bio")}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 text-right",children:[(null===(l=Y.bio)||void 0===l?void 0:l.length)||0,"/160 characters"]}),q.bio&&(0,a.jsx)("p",{className:"text-sm text-red-500",children:q.bio.message})]}),(0,a.jsx)(c.z,{type:"submit",className:"w-full bg-black hover:bg-gray-900 text-white font-semibold py-3 rounded-lg transition-colors",disabled:F,children:F?"Updating...":"Update Profile"}),(0,a.jsx)(c.z,{type:"button",variant:"destructive",className:"w-full",onClick:B,children:"Delete Account"})]})})})})]})}},2869:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var a=r(7437),s=r(2265),o=r(7053),n=r(535),i=r(4508);let l=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=s.forwardRef((e,t)=>{let{className:r,variant:s,size:n,asChild:c=!1,...d}=e,u=c?o.g7:"button";return(0,a.jsx)(u,{className:(0,i.cn)(l({variant:s,size:n,className:r})),ref:t,...d})});c.displayName="Button"},5186:function(e,t,r){"use strict";r.d(t,{I:function(){return n}});var a=r(7437),s=r(2265),o=r(4508);let n=s.forwardRef((e,t)=>{let{className:r,type:s,...n}=e;return(0,a.jsx)("input",{type:s,className:(0,o.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});n.displayName="Input"},6815:function(e,t,r){"use strict";r.d(t,{_:function(){return c}});var a=r(7437),s=r(2265),o=r(6394),n=r(535),i=r(4508);let l=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(o.f,{ref:t,className:(0,i.cn)(l(),r),...s})});c.displayName=o.f.displayName},4991:function(e,t,r){"use strict";r.d(t,{E:function(){return l},m:function(){return c}});var a=r(7437),s=r(2265),o=r(2325),n=r(519),i=r(4508);let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(o.fC,{className:(0,i.cn)("grid gap-2",r),...s,ref:t})});l.displayName=o.fC.displayName;let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(o.ck,{ref:t,className:(0,i.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),...s,children:(0,a.jsx)(o.z$,{className:"flex items-center justify-center",children:(0,a.jsx)(n.Z,{className:"h-3.5 w-3.5 fill-primary"})})})});c.displayName=o.ck.displayName},6818:function(e,t,r){"use strict";r.d(t,{g:function(){return n}});var a=r(7437),s=r(2265),o=r(4508);let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("textarea",{className:(0,o.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...s})});n.displayName="Textarea"},5153:function(e,t,r){"use strict";r.d(t,{pm:function(){return h}});var a=r(2265);let s=0,o=new Map,n=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},l=[],c={toasts:[]};function d(e){c=i(c,e),l.forEach(e=>{e(c)})}function u(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:r});return d({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function h(){let[e,t]=a.useState(c);return a.useEffect(()=>(l.push(t),()=>{let e=l.indexOf(t);e>-1&&l.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},7855:function(e,t,r){"use strict";r.d(t,{x:function(){return o}});let a="https://pharmx-api.kasimhussain333.workers.dev";class s{setAuth(e,t){console.log("[API Client] Setting auth - Token length:",e.length,"Session ID:",t),this.token=e,this.sessionId=t,localStorage.setItem("pharmx_token",e),localStorage.setItem("pharmx_session",t),console.log("[API Client] Stored auth in localStorage")}setToken(e){console.log("[API Client] Setting token only - Length:",e.length),this.token=e,localStorage.setItem("pharmx_token",e),console.log("[API Client] Stored token in localStorage")}getToken(){return this.token||(this.token=localStorage.getItem("pharmx_token")),this.token}getSessionId(){return this.sessionId||(this.sessionId=localStorage.getItem("pharmx_session")),this.sessionId}clearAuth(){this.token=null,this.sessionId=null,localStorage.removeItem("pharmx_token"),localStorage.removeItem("pharmx_session")}clearToken(){this.clearAuth()}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={...t.headers||{}};r["Content-Type"]||t.body instanceof FormData||(r["Content-Type"]="application/json"),this.token&&(r.Authorization="Bearer ".concat(this.token)),this.sessionId&&(r["X-Session-ID"]=this.sessionId);let s="".concat(a).concat(e);console.log("[API] ".concat(t.method||"GET"," ").concat(s)),console.log("[API] Headers:",r),t.body instanceof FormData&&console.log("[API] Sending FormData with keys:",Array.from(t.body.keys()));try{let a=await fetch(s,{...t,headers:r,credentials:"include",mode:"cors"});if(!a.ok){let t="Request failed with status ".concat(a.status),r=null;try{let s=await a.json();t=s.error||s.message||t,r=s.details,console.error("[API Error] ".concat(e,":"),s)}catch(e){t=a.statusText||t}401===a.status&&(console.log("[API] 401 Unauthorized - clearing auth and redirecting to login"),this.clearAuth(),window.location.href="/login");let s=Error(t);throw r&&(s.details=r),s}let o=await a.json();return console.log("[API Response] ".concat(e,":"),o),o}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw console.error("[API] Network error - Failed to fetch. Possible causes:"),console.error("  1. CORS blocking the request"),console.error("  2. Network connectivity issues"),console.error("  3. API server is down"),console.error("  4. SSL/TLS certificate issues"),console.error("  URL: ".concat(s)),Error("Network error: Unable to connect to the server. Please check your connection and try again.");throw e}}constructor(){this.token=null,this.sessionId=null,this.auth={logout:async()=>{await this.request("/auth/logout",{method:"POST"}),this.clearAuth()},verify:()=>this.request("/auth/verify")},this.profile={get:()=>this.request("/profile"),update:e=>this.request("/profile",{method:"PUT",body:JSON.stringify(e)}),uploadAvatar:async e=>{let t=new FormData;return t.append("file",e),this.request("/upload/avatar",{method:"POST",body:t})},create:e=>this.request("/profile",{method:"POST",body:JSON.stringify(e)}),delete:()=>this.request("/profile",{method:"DELETE"})},this.users={list:e=>{let t=new URLSearchParams(e).toString();return this.request("/users".concat(t?"?".concat(t):""))},get:e=>this.request("/users/".concat(e)),search:e=>this.request("/users/search?q=".concat(encodeURIComponent(e)))},this.chats={list:()=>this.request("/chats"),create:e=>this.request("/chats",{method:"POST",body:JSON.stringify({otherUserId:e})}),getMessages:(e,t)=>{let r=new URLSearchParams(t).toString();return this.request("/chats/".concat(e,"/messages").concat(r?"?".concat(r):""))},sendMessage:(e,t)=>this.request("/chats/".concat(e,"/messages"),{method:"POST",body:JSON.stringify({content:t})})},this.health=()=>fetch("".concat(a,"/health")).then(e=>e.json()),this.token=localStorage.getItem("pharmx_token"),this.sessionId=localStorage.getItem("pharmx_session")}}let o=new s},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return o}});var a=r(1994),s=r(3335);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,a.W)(t))}},407:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(9205).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},7648:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var a=r(2972),s=r.n(a)}},function(e){e.O(0,[317,972,528,847,971,117,744],function(){return e(e.s=3630)}),_N_E=e.O()}]);