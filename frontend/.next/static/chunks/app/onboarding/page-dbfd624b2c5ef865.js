(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[461],{9835:function(e,t,r){Promise.resolve().then(r.bind(r,3077))},3077:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return y}});var s=r(7821),a=r(8504),o=r(8078),n=r(746),l=r(4089),i=r(1736),c=r(7469),d=r(7002),u=r(1270),m=r(1579),g=r(6225),h=r(3619),f=r(9198),p=r(9419),x=r(1794);let b=i.Ry({name:i.Z_().min(2).max(40),gender:i.Km(["male","female"]),dobDay:i.Z_().regex(/^(0?[1-9]|[12][0-9]|3[01])$/,"Invalid day"),dobMonth:i.Z_().regex(/^(0?[1-9]|1[012])$/,"Invalid month"),dobYear:i.Z_().regex(/^(19|20)\d{2}$/,"Invalid year").refine(e=>new Date().getFullYear()-parseInt(e)>=18,"You must be at least 18 years old"),bio:i.Z_().max(160),avatarUrl:i.Z_().optional()});function y(){var e,t,r,i;let y=(0,a.useRouter)(),{toast:v}=(0,h.pm)(),[N,w]=(0,o.useState)(""),[j,S]=(0,o.useState)(!1),[I,k]=(0,o.useState)(""),[O,_]=(0,o.useState)(""),[T,A]=(0,o.useState)(""),[P,D]=(0,o.useState)(!0),{register:E,handleSubmit:R,formState:{errors:U,isSubmitting:C},setValue:F,watch:M}=(0,n.cI)({resolver:(0,l.F)(b)}),q=M();if((0,o.useEffect)(()=>{(async()=>{console.log("[Onboarding] === ONBOARDING FLOW START ==="),console.log("[Onboarding] Verifying authentication...");let e=localStorage.getItem("pharmx_token"),t=localStorage.getItem("pharmx_user");if(console.log("[Onboarding] Stored data - Token:",!!e,"User:",!!t),!e||!t){console.log("[Onboarding] ❌ No authentication found, redirecting to login"),y.push("/login");return}console.log("[Onboarding] ✅ Authentication verified"),x.x.setToken(e);try{let e=await x.x.profile.get();if(e&&e.name){console.log("[Onboarding] ⚠️ User already has profile, redirecting to app"),y.push("/app/voice");return}}catch(e){console.log("[Onboarding] Profile check confirmed - no existing profile (expected for new users)")}console.log("[Onboarding] ✅ Ready for profile creation"),D(!1),console.log("[Onboarding] === ONBOARDING FLOW END ===")})()},[y]),P)return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-gray-300 border-t-gray-600 rounded-full animate-spin mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Checking your profile..."})]})});let Y=async e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!r)return;if(console.log("[Onboarding] Selected file:",r.name,"size:",r.size,"type:",r.type),r.size>10485760){v({title:"File too large",description:"Please select an image under 10MB",variant:"destructive"});return}let s=new FileReader;s.onloadend=()=>{w(s.result)},s.readAsDataURL(r),S(!0);try{console.log("[Onboarding] Uploading avatar...");let e=await x.x.profile.uploadAvatar(r);console.log("[Onboarding] Upload result:",e),F("avatarUrl",e.url),v({title:"Photo uploaded",description:"Your profile photo has been updated"})}catch(e){console.error("[Onboarding] Upload error:",e),v({title:"Upload failed",description:e instanceof Error?e.message:"Failed to upload image. Please try again.",variant:"destructive"})}finally{S(!1)}},L=async e=>{try{let t="".concat(e.dobYear,"-").concat(e.dobMonth.padStart(2,"0"),"-").concat(e.dobDay.padStart(2,"0")),r={name:e.name,gender:e.gender,dob:t,bio:e.bio,avatarUrl:e.avatarUrl};console.log("[Onboarding] Submitting profile:",r);let s=await x.x.profile.create(r);console.log("[Onboarding] Profile created:",s),v({title:"Welcome to PharmX Social!",description:"Your profile has been created successfully. Let's find you a voice chat!"}),console.log("[Onboarding] Profile creation successful - redirecting to voice page"),y.push("/app/voice")}catch(t){console.error("[Onboarding] Profile creation error:",t);let e="Failed to create profile. Please try again.";t instanceof Error&&(e=t.message,t.details&&(e="".concat(t.message," - ").concat(t.details))),v({title:"Failed to create profile",description:e,variant:"destructive"}),console.error("[Onboarding] Full error details:",{message:t instanceof Error?t.message:"Unknown error",details:t instanceof Error&&"details"in t?t.details:void 0,error:t})}};return(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-start justify-center p-4 pt-8 sm:pt-16",children:(0,s.jsx)("div",{className:"w-full max-w-2xl lg:max-w-4xl",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 sm:p-8 lg:p-12",children:[(0,s.jsxs)("div",{className:"text-center mb-8 lg:mb-12",children:[(0,s.jsx)("h1",{className:"text-3xl lg:text-4xl font-bold text-gray-900",children:"Complete Your Profile"}),(0,s.jsx)("p",{className:"text-gray-500 mt-2 text-lg",children:"All fields are required"})]}),(0,s.jsxs)("form",{onSubmit:R(L),className:"space-y-6 lg:space-y-8",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,s.jsx)("div",{className:"relative w-32 h-32 sm:w-40 sm:h-40 lg:w-48 lg:h-48 rounded-lg overflow-hidden border-4 border-gray-200",children:N?(0,s.jsx)("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:"url(".concat(N,")")}}):(0,s.jsx)("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center",children:(0,s.jsx)(f.Z,{className:"w-8 h-8 sm:w-12 sm:h-12 lg:w-16 lg:h-16 text-gray-400"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(d.I,{id:"avatar",type:"file",accept:"image/*",className:"hidden",onChange:Y,disabled:j}),(0,s.jsx)(u._,{htmlFor:"avatar",className:"cursor-pointer inline-block",children:(0,s.jsx)("div",{className:"bg-white hover:bg-gray-100 text-black border border-gray-300 px-4 py-2 rounded-md text-sm font-medium transition-colors",children:j?"Uploading...":"Upload Photo"})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-8",children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u._,{htmlFor:"name",className:"text-gray-700 font-medium",children:"Name"}),(0,s.jsx)(d.I,{id:"name",placeholder:"Your display name",className:"w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500",...E("name")}),U.name&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:U.name.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u._,{className:"text-gray-700 font-medium",children:"Gender"}),(0,s.jsxs)(m.E,{onValueChange:e=>F("gender",e),className:"flex gap-6",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(m.m,{value:"male",id:"male",className:"text-black border-gray-400"}),(0,s.jsx)(u._,{htmlFor:"male",className:"text-gray-700 cursor-pointer",children:"Male"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(m.m,{value:"female",id:"female",className:"text-black border-gray-400"}),(0,s.jsx)(u._,{htmlFor:"female",className:"text-gray-700 cursor-pointer",children:"Female"})]})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 flex items-center gap-1",children:[(0,s.jsx)(p.Z,{className:"w-3 h-3"})," Cannot be changed later"]}),U.gender&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:U.gender.message})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u._,{className:"text-gray-700 font-medium",children:"Date of Birth"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(d.I,{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"DD",maxLength:2,className:"w-full text-center border-gray-300 focus:border-blue-500 focus:ring-blue-500",...E("dobDay"),onChange:e=>{let t=e.target.value.replace(/\D/g,"");if(k(t),F("dobDay",t),2===t.length){let e=document.querySelector('input[name="dobMonth"]');null==e||e.focus()}},value:I})}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(d.I,{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"MM",maxLength:2,className:"w-full text-center border-gray-300 focus:border-blue-500 focus:ring-blue-500",...E("dobMonth"),onChange:e=>{let t=e.target.value.replace(/\D/g,"");if(_(t),F("dobMonth",t),2===t.length){let e=document.querySelector('input[name="dobYear"]');null==e||e.focus()}},value:O})}),(0,s.jsx)("div",{className:"flex-[1.5]",children:(0,s.jsx)(d.I,{type:"text",inputMode:"numeric",pattern:"[0-9]*",placeholder:"YYYY",maxLength:4,className:"w-full text-center border-gray-300 focus:border-blue-500 focus:ring-blue-500",...E("dobYear"),onChange:e=>{let t=e.target.value.replace(/\D/g,"");A(t),F("dobYear",t)},value:T})})]}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"You must be 18 or older"}),(U.dobDay||U.dobMonth||U.dobYear)&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:(null===(e=U.dobDay)||void 0===e?void 0:e.message)||(null===(t=U.dobMonth)||void 0===t?void 0:t.message)||(null===(r=U.dobYear)||void 0===r?void 0:r.message)})]})]}),(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(u._,{htmlFor:"bio",className:"text-gray-700 font-medium",children:"Bio"}),(0,s.jsx)(g.g,{id:"bio",placeholder:"Tell us about yourself...",className:"resize-none h-32 lg:h-40 w-full border-gray-300 focus:border-blue-500 focus:ring-blue-500",maxLength:160,...E("bio")}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 text-right",children:[(null===(i=q.bio)||void 0===i?void 0:i.length)||0,"/160 characters"]}),U.bio&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:U.bio.message})]})})]}),(0,s.jsx)("div",{className:"pt-4",children:(0,s.jsx)(c.z,{type:"submit",className:"w-full lg:w-auto lg:px-12 bg-black hover:bg-gray-900 text-white font-semibold py-3 rounded-lg transition-colors",disabled:C,children:C?"Creating Profile...":"Complete Profile"})})]})]})})})}},7469:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var s=r(7821),a=r(8078),o=r(7035),n=r(898),l=r(3892);let i=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:n,asChild:c=!1,...d}=e,u=c?o.g7:"button";return(0,s.jsx)(u,{className:(0,l.cn)(i({variant:a,size:n,className:r})),ref:t,...d})});c.displayName="Button"},7002:function(e,t,r){"use strict";r.d(t,{I:function(){return n}});var s=r(7821),a=r(8078),o=r(3892);let n=a.forwardRef((e,t)=>{let{className:r,type:a,...n}=e;return(0,s.jsx)("input",{type:a,className:(0,o.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});n.displayName="Input"},1270:function(e,t,r){"use strict";r.d(t,{_:function(){return c}});var s=r(7821),a=r(8078),o=r(5641),n=r(898),l=r(3892);let i=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(o.f,{ref:t,className:(0,l.cn)(i(),r),...a})});c.displayName=o.f.displayName},1579:function(e,t,r){"use strict";r.d(t,{E:function(){return i},m:function(){return c}});var s=r(7821),a=r(8078),o=r(8993),n=r(2819),l=r(3892);let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(o.fC,{className:(0,l.cn)("grid gap-2",r),...a,ref:t})});i.displayName=o.fC.displayName;let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(o.ck,{ref:t,className:(0,l.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),...a,children:(0,s.jsx)(o.z$,{className:"flex items-center justify-center",children:(0,s.jsx)(n.Z,{className:"h-3.5 w-3.5 fill-primary"})})})});c.displayName=o.ck.displayName},6225:function(e,t,r){"use strict";r.d(t,{g:function(){return n}});var s=r(7821),a=r(8078),o=r(3892);let n=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("textarea",{className:(0,o.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...a})});n.displayName="Textarea"},3619:function(e,t,r){"use strict";r.d(t,{pm:function(){return m}});var s=r(8078);let a=0,o=new Map,n=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?n(r):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],c={toasts:[]};function d(e){c=l(c,e),i.forEach(e=>{e(c)})}function u(e){let{...t}=e,r=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),s=()=>d({type:"DISMISS_TOAST",toastId:r});return d({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||s()}}}),{id:r,dismiss:s,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function m(){let[e,t]=s.useState(c);return s.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},1794:function(e,t,r){"use strict";r.d(t,{x:function(){return o}});let s=r(8571).env.NEXT_PUBLIC_API_URL||"https://pharmx-api.kasimhussain333.workers.dev";class a{setAuth(e,t){console.log("[API Client] Setting auth - Token length:",e.length,"Session ID:",t),this.token=e,this.sessionId=t,localStorage.setItem("pharmx_token",e),localStorage.setItem("pharmx_session",t),console.log("[API Client] Stored auth in localStorage")}setToken(e){console.log("[API Client] Setting token only - Length:",e.length),this.token=e,localStorage.setItem("pharmx_token",e),console.log("[API Client] Stored token in localStorage")}getToken(){return this.token||(this.token=localStorage.getItem("pharmx_token")),this.token}getSessionId(){return this.sessionId||(this.sessionId=localStorage.getItem("pharmx_session")),this.sessionId}clearAuth(){this.token=null,this.sessionId=null,localStorage.removeItem("pharmx_token"),localStorage.removeItem("pharmx_session")}clearToken(){this.clearAuth()}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={...t.headers||{}};r["Content-Type"]||t.body instanceof FormData||(r["Content-Type"]="application/json"),this.token&&(r.Authorization="Bearer ".concat(this.token)),this.sessionId&&(r["X-Session-ID"]=this.sessionId);let a="".concat(s).concat(e);console.log("[API] ".concat(t.method||"GET"," ").concat(a)),console.log("[API] Headers:",r),t.body instanceof FormData&&console.log("[API] Sending FormData with keys:",Array.from(t.body.keys()));try{let s=await fetch(a,{...t,headers:r,credentials:"include",mode:"cors"});if(!s.ok){let t="Request failed with status ".concat(s.status),r=null;try{let a=await s.json();t=a.error||a.message||t,r=a.details,console.error("[API Error] ".concat(e,":"),a)}catch(e){t=s.statusText||t}401===s.status&&(console.log("[API] 401 Unauthorized - clearing auth and redirecting to login"),this.clearAuth(),window.location.href="/login");let a=Error(t);throw r&&(a.details=r),a}let o=await s.json();return console.log("[API Response] ".concat(e,":"),o),o}catch(e){if(e instanceof TypeError&&"Failed to fetch"===e.message)throw console.error("[API] Network error - Failed to fetch. Possible causes:"),console.error("  1. CORS blocking the request"),console.error("  2. Network connectivity issues"),console.error("  3. API server is down"),console.error("  4. SSL/TLS certificate issues"),console.error("  URL: ".concat(a)),Error("Network error: Unable to connect to the server. Please check your connection and try again.");throw e}}constructor(){this.token=null,this.sessionId=null,this.auth={logout:async()=>{await this.request("/auth/logout",{method:"POST"}),this.clearAuth()},verify:()=>this.request("/auth/verify")},this.profile={get:()=>this.request("/profile"),update:e=>this.request("/profile",{method:"PUT",body:JSON.stringify(e)}),uploadAvatar:async e=>{let t=new FormData;return t.append("file",e),this.request("/upload/avatar",{method:"POST",body:t})},create:e=>this.request("/profile",{method:"POST",body:JSON.stringify(e)}),delete:()=>this.request("/profile",{method:"DELETE"})},this.users={list:e=>{let t=new URLSearchParams(e).toString();return this.request("/users".concat(t?"?".concat(t):""))},get:e=>this.request("/users/".concat(e)),search:e=>this.request("/users/search?q=".concat(encodeURIComponent(e)))},this.chats={list:()=>this.request("/chats"),create:e=>this.request("/chats",{method:"POST",body:JSON.stringify({otherUserId:e})}),getMessages:(e,t)=>{let r=new URLSearchParams(t).toString();return this.request("/chats/".concat(e,"/messages").concat(r?"?".concat(r):""))},sendMessage:(e,t)=>this.request("/chats/".concat(e,"/messages"),{method:"POST",body:JSON.stringify({content:t})})},this.health=()=>fetch("".concat(s,"/health")).then(e=>e.json()),this.token=localStorage.getItem("pharmx_token"),this.sessionId=localStorage.getItem("pharmx_session")}}let o=new a},3892:function(e,t,r){"use strict";r.d(t,{cn:function(){return o}});var s=r(2605),a=r(1638);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}}},function(e){e.O(0,[966,423,285,124,115,364,744],function(){return e(e.s=9835)}),_N_E=e.O()}]);